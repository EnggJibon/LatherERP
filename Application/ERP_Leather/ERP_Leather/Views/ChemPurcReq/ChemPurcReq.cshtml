@{
    ViewBag.Title = "Chemical Purchase Requisition";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //var pageOperation = new[] {"CHK", "CNF", "APV"};
}

@*@Html.Partial("~/Views/Common/_FormHeader.cshtml")*@
<div class="row">

    <div class="FormHeader">
        <fieldset id="FormHeaderFieldSet">

            <div id="FormTitlePannel" class="col-lg-4">
                <div id="FormTitle" style="font-size:larger; font-weight:bold;">@ViewBag.formTiltle</div>
            </div>
            <div id="MessageText" class="col-lg-6">

            </div>
            <div id="ButtonPanel" class="col-lg-2">
                <input type="button" id="btnReset" class="Button" value="Reset" style="position:absolute; right:20px;" />
                <input type="button" id="btnDelete" class="Button" value="Delete" style="position:absolute; right:75px;" />
                <input type="button" id="btnSearch" class="Button" value="Search" style="position:absolute; right:135px;" />
                <input type="button" id="btnSave" class="Button disabled" value="Save" onclick="SaveData()" style="position:absolute; right:200px;" />
            </div>
        </fieldset>
    </div>

</div>

<div class="row">
    <div class="FormBody">
        <div class="row">
            <div class="col-lg-2">
                <label>Requisition Category</label>
            </div>
            <div class="col-lg-2">
                <select class="txtBox RequiredTextBox Dropdown" id="RequisitionCategory">
                    <option selected="selected" value="FP">Foreign</option>
                    <option value="LP">Local</option>
                </select>
            </div>
            <div class="col-lg-4"></div>
            <div class="col-lg-2">
                <label>Requisition No</label>
            </div>
            <div class="col-lg-2">
                <input type="text" id="RequisitionNo" class="txtBox ReadOnlyTextbox" name="" tabindex="" readonly="readonly" />
                <input type="hidden" id="RequisitionID" />
            </div>

        </div>
        <div class="row">
            <div class="col-lg-2">
                <label>Requisition Type</label>
            </div>
            <div class="col-lg-2">
                <select class="txtBox  RequiredTextBox Dropdown " id="RequisitionType">
                    <option selected="selected" value="NR">Normal</option>
                    <option value="UR">Urgent</option>
                </select>
            </div>
            <div class="col-lg-4"></div>
            <div class="col-lg-2">
                <label>Requisition Date</label>
            </div>
            <div class="col-lg-2">
                <input type="text" id="RequisitionDate" class="datePicker" required="required" name="" tabindex="" />
            </div>
        </div>
        <div class="row">
            <div class="col-lg-2">
                <label>Requisition Raised By</label>
            </div>
            <div class="col-lg-4">
                @Html.DropDownList("ReqRaisedByName", new SelectList(ViewBag.ddlUserList, "UserID", "NameWithDesignation"), "--Select User--", new { @class = "txtBox Dropdown RequiredTextBox" })
            </div>
            <div class="col-lg-2">
            </div>

            <div class="col-lg-2">
                <label>Required By </label>
            </div>
            <div class="col-lg-1">
                <input type="text" id="RequiredByTime" class="txtBox" maxlength="3" name="" tabindex="" />
            </div>
            <div class="col-lg-1">
                <label> Day's</label>
            </div>
        </div>
    </div>

    <div class="FormBody">
        <div class="row">
            <div class="col-lg-1">
                <label>Supplier</label>
            </div>
            <div class="col-lg-2">
                <input type="text" id="SupplierCode" class="txtBox "  placeholder="Press F9" name="" tabindex="" readonly="readonly" />
                <input type="hidden" id="SupplierID" class="txtBox ">
            </div>
            <div class="col-lg-3">
                <input type="text" id="SupplierName" class="txtBox" name="" tabindex="" readonly="readonly" />
            </div>
            <div class="col-lg-2">
            </div>
            <div class="col-lg-1">
                <label>Requisition From</label>
            </div>
            <div class="col-lg-3">
                @Html.DropDownList("RequisitionFrom", new SelectList(ViewBag.ddlStoreList, "StoreID", "StoreName"), "--Select--", new { @class = "txtBox Dropdown RequiredTextBox" })
            </div>
        </div>
    </div>

    <div class="FormBody">
        <div class="row">
            <div class="col-lg-12">
                <div id="PageDetailGrid"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <label id="" style="margin-left:630px;">Total Requisition Quantity</label>
                <input type="text" readonly="readonly" class="txtBox" id="txtTotalRequisitionQty" style="width: 100px; text-align: center; font-weight:bold; " />
            </div>
        </div>
    </div>
    <div class="FormBody" style="font-size: 12px;">
        <div class="row">
            <div class="col-lg-1" style=" padding-right:0;">
                <label style="">Check Note</label>
            </div>
            <div class="col-lg-4" style="padding-left:0; padding-right:0;">
                <textarea id="checkComment" class="txtBox" tabindex="" style="float:left; width:410px;height:60px; "></textarea>
            </div>
            <div class="col-lg-1">
                <input type="button" tabindex="" id="btnCheck" value="Check" style="position: absolute;  font-size: 12px;" />
            </div>
            <div class="col-lg-1" style=" padding-right:0;">
                <label style="">Confirm Note</label>
            </div>
            <div class="col-lg-4" style="padding-left:0; padding-right:0;">
                <textarea id="confirmComment" class="txtBox" tabindex="" style="float: left; width:410px; height: 60px;"></textarea>
            </div>
            <div class="col-lg-1">
                <input type="button" tabindex="" id="btnConfirm" value="Confirm" style="position: absolute; font-size: 12px; " />
            </div>
        </div>
    </div>
</div>

<div id="ChemicalWindow" style="display: none;">
    <p>Chemical Name:<input type="text" id="txtChemical" style="width: 250px;" /><input type="button" id="btnGridSearch" value="Search" /></p>
    <div id="ChemicalWindowGrid" class="PopUpGrid">
    </div>
    <input type="button" id="btnChemicalWindowCancel" class="PopUpButton" value="Cancel" />
    <input type="button" id="btnChemicalWindowOK" class="PopUpButton" value="OK" />
</div>

<div id="SearchWindow" style="display: none;">
    <div id="SearchWindowGrid" class="PopUpGrid">
    </div>
    <input type="button" id="btnSearchWindowCancel" class="PopUpButton" value="Cancel" />
    <input type="button" id="btnSearchWindowOK" class="PopUpButton" value="OK" />
</div>

<div id="DeleteConfirmWindow" style="display: none;">
    <p><h5>Are you sure to delete?</h5></p>
    <input type="button" style="height: 25px; width: 60px; margin-left: 10px; float: left;" id="btnConfirmationOK" value="OK" />
    <input type="button" style="height: 25px; width: 60px; margin-left: 30px; float: left;" id="btnConfirmationCancel" value="Cancel" />
</div>

<div id="SaveChangeWindow" style="display: none;">
    <p><h5>Data will be lost if you continue.</h5></p>
    <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowOk" value="OK" />
    <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowCancel" value="Cancel" />
</div>

<div id="SupplierWindow" style="display: none;">
    @*<p>Supplier:<input type="text" id="txtSupplier" style="width: 250px;" /><input type="button" id="btnGridSearch" value="Search" /></p>*@
    <div id="SupplierWindowGrid" class="PopUpGrid">
    </div>
    <input type="button" id="btnSupplierWindowCancel" class="PopUpButton" value="Cancel" />
    <input type="button" id="btnSupplierWindowOK" class="PopUpButton" value="OK" />
</div>
<div id="ManufacturerSearchWindow" style="display: none;">
    @*<div class="row" style="width: 596px;">
            <label style="margin-left: 20px;">Item</label>
            <input type="text" id="txtSupplier" style="width: 250px;" /><input type="button" id="btnSupplierGridSearch" value="Search" style="margin-left: 2px; margin-top: 1px;" />
        </div>*@
    <div class="row" style="width: 596px;">
        <div id="ManufacturerSearchWindowGrid" class="PopUpGrid" style="margin-left: 20px;">
        </div>
    </div>
    <div class="row" style="width: 596px;">
        <input type="button" id="btnManufacturerWindowCancel" class="PopUpButton" value="Cancel" style="margin-right: 10px;" />
        <input type="button" id="btnManufacturerWindowOK" class="PopUpButton" value="OK" />
    </div>
</div>
<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 42%; color: White;">
        Please wait... <img src="../../images/ajax-loading.gif">
    </p>
</div>

<script type="text/javascript">
    // To Declare Global Variable
    var recordStatus = "";
    var changeStatus = 0;
    var resetEditDeleteStatus = 0;
    var deleteStatus = 0;
    var checkGridData = 1;
    var dataitem = {};
    //To select the first row as default & to clear the filter while loading the grid
    function SelectedItemOfListOfValue(gridName) {
        var grid = $('#' + gridName).data("kendoGrid");
        //Reload Grid
        grid.dataSource.read();
        //Clear Filter
        $('#' + gridName).data("kendoGrid").dataSource.filter([]);
        //Select First Row
        $('#' + gridName).data().kendoGrid.bind('dataBound', function (e) {
            this.element.find('tbody tr:first').addClass('k-state-selected');
        });
    }

    //To Bring Data from List of Value Grid to Main Page
    function ListOfValueGridEvent(gridName) {
        var grid = $('#' + gridName).data("kendoGrid");
        var selectedItem = (grid.dataItem(grid.select())); //Selected Row
        changeStatus = 1;
        $.each(selectedItem, function (key, value) {
            if (value != null && value != 0)
                $('#' + key).val(value);
        });
    }

    // create DatePicker from input HTML element
    $(".datePicker").kendoDatePicker({
        format: "{0:dd/MM/yyyy}",
        value: new Date(),
        max: new Date()
    });
    function isEditable(model) {
        // default to editable if no IsEditable attribute
        return !model.hasOwnProperty("SafetyStock") || model.IsEditable;
    }

    $(document).ready(function () {

        //--------------------------To enable search option in supplier list of value pop up-------------------------------------
        // CheckRecordStatusForButton(recordStatus);
        OnlyNumericValue('RequiredByTime');

        var chemicalSearchDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("GetChemicalListForSearch", "ChemicalItem")',
                    type: "GET"
                }
            }
        });
        $("#txtChemical").kendoAutoComplete({
            dataSource: chemicalSearchDataSource,
            filter: "startswith",
            placeholder: "Search Chemical By Name..."
        });

        $("#btnGridSearch").click(function () {
            $.ajax({
                url: '@Url.Action("GetChemicalListSearchByName", "ChemicalItem")',
                type: 'GET',
                data: { chemicalName: $("#txtChemical").val() },
                success: function (data33) {
                    $("#ChemicalWindowGrid").data("kendoGrid").dataSource.data(data33);
                    if (data33.Count == 1) {
                        ListOfValueGridEvent('ChemicalWindowGrid');

                        chemicalWindow.close();
                    }
                }
            });
        });
        $("#txtChemical").keyup(function (event) {
            if ($("#txtChemical").is(':focus')) {
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    $.ajax({
                        url: '@Url.Action("GetChemicalListSearchByName", "ChemicalItem")',
                        type: 'GET',
                        data: { chemicalName: $("#txtChemical").val() },
                        success: function (data33) {
                            $("#ChemicalWindowGrid").data("kendoGrid").dataSource.data(data33);
                            if (data33.Count == 1) {
                                ListOfValueGridEvent('ChemicalWindowGrid');

                                chemicalWindow.close();
                            }
                        }
                    });
                }
            }
        });

        //--------------------------End of enabling search option in supplier list of value pop up-------------------------------------
        //--------------------------------------Start of defining Page Datail Datagrid--------------------------------------------------------



        var gridDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "RequisitionItemID",
                    fields: {
                        RequisitionItemID: { editable: true },
                        //SupplierID: { editable: true },
                        ItemID: { editable: true },
                        ItemName: { editable: true, defaultValue: 'Press F9' },
                        SafetyStock: { editable: true },
                        PipelineQty: { editable: true },
                        TotalQty: { editable: true },
                        ReorderLevel: { editable: true },
                        ProdReqQty: { editable: true },
                        SizeID: { editable: true, validation: { required: false } },
                        SizeName: { editable: true, validation: { required: false } },
                        PackUnitID: { editable: true, validation: { required: false } },
                        PackUnitName: { editable: true, validation: { required: false } },
                        PackQty: { editable: true, type: "number", validation: { required: false, min: 1, max: 999999999999 }, defaultValue: '' },
                        RequisitionQty: { editable: true, type: "number", validation: { required: true, min: 1, max: 999999999999 }, defaultValue: '' },
                        UnitID: { editable: true },
                        UnitName: { editable: true },
                        ManufacturerID: { editable: true },
                        ManufacturerName: { editable: true, defaultValue: 'Press F9' }

                    }
                }
            },
            pageSize: 50

        });
        var itemgrid = $("#PageDetailGrid").kendoGrid({
            dataSource: gridDataSource,
            pageable: true,
            groupable: true,
            edit: function (e) {

                var ddl = e.container.find('[data-role=dropdownlist]').data('kendoDropDownList');
                if (ddl) {
                    ddl.open();
                }

                var fieldName = e.container.find("input").attr("name");

                switch (fieldName) {
                    case "SafetyStock":
                        this.closeCell();
                        break;
                    case "PipelineQty":
                        this.closeCell();
                        break;
                    case "TotalQty":
                        this.closeCell();
                        break;
                    case "ReorderLevel":
                        this.closeCell();
                        break;
                    case "ProdReqQty":
                        this.closeCell();
                        break;
                }

                $("[name='ManufacturerName']", e.container).keyup(function (event) {
                    if (event.keyCode == 120) {
                        $(this).val("");
                        ManufacturerWindow.open();
                        ManufacturerWindow.center();
                    }
                });
                $("[name='PackQty']", e.container).blur(function () {
                    var totalRequisitionQty = 0;
                    var grid = $("#PageDetailGrid").data("kendoGrid");
                    var row = $(this).closest("tr");
                    if (grid.dataItem(row).PackQty != 0 && grid.dataItem(row).SizeID != 0) {
                        totalRequisitionQty = grid.dataItem(row).PackQty * parseFloat(grid.dataItem(row).SizeName);
                        grid.dataItem(row).RequisitionQty = totalRequisitionQty;
                    }
                });
                $("[name='RequisitionQty']", e.container).blur(function (e) {
                    DisplayRequsitionTotalQty();
                });
            },
            editable:true,
            selectable: "row",
            toolbar: [{ text: "Add Chemical Purchase Item", className: "btnPageDetailGrid", imageClass: "k-icon k-add" }],
            navigatable: true,
            filterable: true,
            sortable: true,
            columns: [
                { field: "RequisitionItemID", hidden: true, },
                { field: "ItemID", hidden: true },
                { field: "ItemName", title: "Chemical Name", width: "60px", attributes: { "class": "ItemName", "placeholder": "optional" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "SafetyStock", title: "Chemical Stock Qty", width: "60px", editable: false, filterable: false, attributes: { "class": "Readonly", style: "background-color: silver" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "PipelineQty", title: "Pipeline Qty", width: "60px", filterable: false, attributes: { "class": "Readonly", style: "background-color: silver" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "TotalQty", title: "Total Qty", width: "60px", filterable: false, attributes: { "class": "Readonly", style: "background-color: silver" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "ReorderLevel", title: "Re-Order Level", width: "60px", filterable: false, attributes: { "class": "Readonly", style: "background-color: silver" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "ProdReqQty", title: "Production Requisition Qty", width: "60px", filterable: false, attributes: { "class": "Readonly", style: "background-color: silver" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },

                { field: "SizeID", hidden: true },
                { field: "SizeName", title: "Pack Size", width: "60px", editor: ddlPackSize, filterable: false, sortable: false, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },

                { field: "PackUnitID", hidden: true },
                { field: "PackUnitName", title: "Pack Size Unit", width: "60px", editor: ddlPackSizeUnit, filterable: false, sortable: false, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { field: "PackQty", title: "Pack Qty", editable: true, width: "50px", filterable: false, attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" }},

                { field: "RequisitionQty", title: "Requisition Qty<span style='color:red'>*</span>", editable: true, width: "60px", filterable: false, attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" }},

                { field: "UnitID", hidden: true },
                { field: "UnitName", title: "Unit<span style='color:red'>*</span>", width: "50px", editor: ddlUnit, filterable: false, sortable: false, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },

                //{ field: "ApprovedQty", hidden: false, title: "Approved Qty*", editable: true, width: "60px", filterable: false, attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },

                { field: "ManufacturerID", hidden: true },
                { field: "ManufacturerName", title: "Manufacturer", editable: true, filterable: false, width: "80px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                { command: [{ name: "DeltedRow", text: "Delete", click: handleDeleteItem }], title: "Action", width: 50, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; text-align:center" } }
            ]

        });
       

        function DisplayRequsitionTotalQty(){
             var totalReqQty = 0;
             var itemGridDataSource = $("#PageDetailGrid").data("kendoGrid").dataSource;
             var gridData = itemGridDataSource.data();

             for (i = 0; i<gridData.length ; i++) {
                 totalReqQty += parseInt(gridData[i].RequisitionQty);
             }
             $("#txtTotalRequisitionQty").val(totalReqQty.toFixed(2));
        }
        // Summation of Gross Weight
        function SumGrossRequisitionQty() {
            // assume this to be dynamically determined
            var field = "RequisitionQty";
            // assume this to be dynamically determined
            var dataSource = gridDataSource;
            // some custom calc logic
            var newValue = 0;
            $.each(dataSource.data(), function (index, model) {
                newValue += parseFloat(model.get(field));
            });
            if (isNaN(newValue)) {
                newValue = 0;
            }
            return newValue.toFixed(2);
        }
        $(".btnPageDetailGrid").click(function () {
            var supplieragentgrid = $("#PageDetailGrid").data("kendoGrid");
            $("#PageDetailGrid").data().kendoGrid.bind('dataBound', function () {
                this.element.find('tbody tr:first').addClass('k-state-selected');
            });
            supplieragentgrid.addRow();
        });

        $("#PageDetailGrid").keyup(function (e) {
            if (e.keyCode == 13) {
                var supplieragentgrid = $("#PageDetailGrid").data("kendoGrid");
                $("#PageDetailGrid").data().kendoGrid.bind('dataBound', function () {
                    this.element.find('tbody tr:first').addClass('k-state-selected');
                });
                supplieragentgrid.addRow().columnHide(13);
            }
        });

        //--------------------------------------End of defining Datagrid--------------------------------------------------------

        //----------------------------------------To open all the pop up windows--------------------------------------------------------------------



        $(document).on('keyup', '.ItemName', function (e) {
            if (e.which == 120) {
                SelectedItemOfListOfValue('ChemicalWindowGrid');
                $("#txtChemical").val('');
                chemicalWindow.open(); //Open Popup
            }

        });


        $(document.body).keyup(function (e) {

            if ($("#SupplierCode").is(":focus")) {
                if (e.keyCode == 120) {
                    $("#txtSupplier").val("");
                    SelectedItemOfListOfValue('SupplierWindowGrid');

                    $.ajax({
                        url: '@Url.Action("GetChemicalSupplierByType", "CommonChemical")',
                        type: 'GET',
                        data: ({ "supplierType": $("#RequisitionCategory").val() }),
                        success: function (response) {
                            $("#SupplierWindowGrid").data("kendoGrid").dataSource.data(response);
                        }
                    });
                    supplierWindow.open();
                    supplierWindow.center();
                }
            }
        });


        //----------------------------------------End of opening all the pop up windows--------------------------------------------------------------------

        // Handling button click for Supplier window grid
        $('#btnSupplierWindowOK').click(function () {
            ListOfValueGridEvent('SupplierWindowGrid');
            supplierWindow.close();
        });
        $('#btnSupplierWindowCancel').click(function () {
            supplierWindow.close();
        });
        $("#SupplierWindowGrid").dblclick(function () {
            ListOfValueGridEvent('SupplierWindowGrid');
            supplierWindow.close();
        });
        $("#SupplierWindowGrid").keyup(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                ListOfValueGridEvent('SupplierWindowGrid');
                supplierWindow.close();

            }
                // Close Window with escape key
            else if (keycode == '27') {
                supplierWindow.close();
            }
            event.stopPropagation();
        });

        //Handling button click for Chemical window grid

        $('#btnChemicalWindowOK').click(function () {
            listOfValueGridEvent();
            chemicalWindow.close();
        });

        $('#btnChemicalWindowCancel').click(function () {
            chemicalWindow.close();
        });

        $("#ChemicalWindowGrid").dblclick(function () {
            listOfValueGridEvent();
            chemicalWindow.close();
        });

        $("#ChemicalWindowGrid").keyup(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                listOfValueGridEvent();
                chemicalWindow.close();
            }
                // Close Window with escape key
            else if (keycode == '27') {
                chemicalWindow.close();
            }
            event.stopPropagation();
        });


        //To Bring Data from List of Value Grid to Main Page
        function listOfValueGridEvent() {
            var windowGrid = $("#ChemicalWindowGrid").data("kendoGrid");
            var windowGridRow = windowGrid.select();
            var windowGridItem = windowGrid.dataItem(windowGridRow);

            var pageGrid = $("#PageDetailGrid").data("kendoGrid");
            var pageGridItem = pageGrid.dataItem(pageGrid.select());

            pageGridItem.set("ItemID", windowGridItem.ItemID);
            pageGridItem.set("ItemName", windowGridItem.ItemName);
            pageGridItem.set("SafetyStock", windowGridItem.StockQty);
            pageGridItem.set("PipelineQty", windowGridItem.PipelineQty);
            pageGridItem.set("TotalQty", windowGridItem.TotalQty);
            pageGridItem.set("ReorderLevel", windowGridItem.ReorderLevel);
            pageGridItem.set("ProdReqQty", windowGridItem.ProdReqQty);

            pageGridItem.set("UnitID", windowGridItem.UnitID);
            pageGridItem.set("UnitName", windowGridItem.UnitName);

            $("#PageDetailGrid").data().kendoGrid.bind('dataBound', function () {
                this.element.find('tbody tr:first').addClass('k-state-selected');
            });

        }
        //--------------------------------------Start of Defining Datasource & Dropdown--------------------------------------------

        var chemicalGridDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "ItemID",
                    fields: {
                        ItemID: { editable: false },
                        ItemName: { editable: false },
                        HSCode: { editable: false },
                        StockQty: { editable: false },
                        PipelineQty: { editable: false },
                        TotalQty: { editable: false },
                        ReorderLevel: { editable: false },
                        SafetyStock: { editable: false },
                        ProdReqQty: { editable: false },
                        UnitID: { editable: false },
                        UnitName: { editable: false }
                    }
                }
            },
            transport: {
                read: {
                    url: '@Url.Action("GetAllChemicalPurchaseItems", "ChemPurcReq")',
                    type: "GET",
                    dataType: "JSON"
                }
            },
            pageSize: 50

        });

        var chemicalGrid = $("#ChemicalWindowGrid").kendoGrid({
            dataSource: chemicalGridDataSource,
            pageable: true,
            editable: true,
            selectable: "row",
            navigatable: true,
            filterable: true,
            sortable: true,
            height: 400,
            columns: [
                  { field: "ItemID", title: "Chemical ID", width: "30px", hidden: true, filterable: false, sortable: false },
                  { field: "ItemName", title: "Chemical Name", width: "80px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                  { field: "HSCode", title: "HSCode", width: "50px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                  { field: "StockQty", title: "Stock Qty", width: "60px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; " } },
                  { field: "PipelineQty", title: "Pipeline Qty", width: "60px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } },
                  { field: "TotalQty", title: "Total Qty", width: "60px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; " } },
                  { field: "ReorderLevel", title: "Re-OrderLevel", width: "60px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; " } },
                  { field: "SafetyStock", title: "Safety Stock Qty", width: "70px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; " } },
                  { field: "ProdReqQty", title: "Production Requisition Qty", width: "80px", attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px; " } },

                  { field: "UnitID", hidden: true, width: "60px", filterable: false, sortable: false },
                  { field: "UnitName", hidden: false, title: "Unit", width: "60px", filterable: false, sortable: false, attributes: { "class": "txtBox" }, headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;" } }
            ]

        });
        var supplierGridDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "SupplierID",
                    fields: {
                        SupplierID: { editable: false },
                        SupplierCode: { editable: false },
                        SupplierName: { editable: false },
                        Address: { editable: false },
                        SupplierAddressID: { editable: false },
                        ContactPerson: { editable: false },
                        ContactNumber: { editable: false },
                    }
                }
            },
            @*transport: {
                read: {
                    url: '@Url.Action("GetAllChemicalSupplier", "CommonChemical")',
                    type: "GET",
                    dataType: "JSON"
                }
            },*@
            pageSize: 50

        });

        var supplierGrid = $("#SupplierWindowGrid").kendoGrid({
            dataSource: supplierGridDataSource,
            pageable: true,
            editable: true,
            selectable: "row",
            navigatable: true,
            //filterable: true,
            filterable: {
                extra: false,
                operators: {
                    string: {
                        startswith: "Starts with"
                    }
                }
            },
            sortable: true,
            height: 300,
            columns: [
                  { field: "SupplierID", hidden: true, title: "Supplier ID", width: "60px" },
                  { field: "SupplierName", title: "Supplier Name", width: "80px", filterable: { ui: supplierFilter } },
                  { field: "SupplierCode", title: "Supplier Code", width: "60px" },
                  { field: "Address", title: "Address", width: "60px" },
                  { field: "ContactPerson", title: "Contact Person", width: "60px" },
                  { field: "ContactNumber", title: "Contact Number", width: "60px" }
            ]
        });

        function supplierFilter(element) {
            element.kendoAutoComplete({
                dataSource: supplierSearchDataSource,
                placeholder: "Search Supplier...",
            });
        }
        var supplierSearchDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("GetChemicalSupplierByTypeForSearch", "CommonChemical")',
                    type: "GET",
                    data: ({ "supplierType": $("#RequisitionCategory").val() }),
                }
            }
        });
        // ------------Start Grid Detail ddl List panel----------------
        // Data Source of ddlUnit
        var ddlUnitDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "UnitID",
                    fields: {
                        UnitID: { editable: false },
                        UnitName: { editable: false }
                    }
                }
            },
            pageSize: 100,
            transport: {
                read: {
                    url: '@Url.Action("GetAllUnitForChemical", "CommonChemical")',
                    type: "GET",
                    dataType: "JSON"
                }
            }
        });
        function ddlUnit(container, options) {
            $('<input name="UnitID" data-bind="value:' + options.field + '"/>')
                .appendTo(container)
                .kendoDropDownList({
                    dataTextField: "UnitName",
                    dataValueField: "UnitID",
                    optionLabel: "Select",
                    autoBind: false,
                    dataSource: ddlUnitDataSource,
                    change: function (e) {
                        changeStatus = 1;
                        var dataItem = e.sender.dataItem();
                        options.model.set("UnitName", dataItem.UnitName);
                        options.model.set("UnitID", dataItem.UnitID);
                    },
                });
        }

        // Data Source of ddlPackSize
        var ddlPackSizeDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "SizeID",
                    fields: {
                        SizeID: { editable: false },
                        SizeName: { editable: false },
                    }
                }
            },
            pageSize: 100,
            transport: {
                read: {
                    url: '@Url.Action("GetAllPackSizeForChemical", "CommonChemical")',
                    type: "GET",
                    dataType: "JSON"
                }
            }
        });

        function ddlPackSize(container, options) {
            $('<input name="SizeID" data-bind="value:' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        dataTextField: "SizeName",
                        dataValueField: "SizeID",
                        optionLabel: "Select",
                        dataSource: ddlPackSizeDataSource,
                        autoBind: false,
                        change: function (e) {
                            changeStatus = 1;
                            var dataItem = e.sender.dataItem();
                            options.model.set("SizeName", dataItem.SizeName);
                            options.model.set("SizeID", dataItem.SizeID);
                        }
                    });
        };


        // Data Source of ddlPackSizeUnit
        var ddlPackSizeUnitDataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "PackUnitID",
                    fields: {
                        PackUnitID: { editable: false },
                        PackUnitName: { editable: false }
                    }
                }
            },
            pageSize: 100,
            transport: {
                read: {
                    url: '@Url.Action("GetAllPackUnitForChemical", "CommonChemical")',
                    type: "GET",
                    dataType: "JSON"
                }
            }
        });
        function ddlPackSizeUnit(container, options) {
            $('<input name="PackUnitID" data-bind="value:' + options.field + '"/>')
                .appendTo(container)
                .kendoDropDownList({
                    dataTextField: "PackUnitName",
                    dataValueField: "PackUnitID",
                    optionLabel: "Select",
                    autoBind: false,
                    dataSource: ddlPackSizeUnitDataSource,
                    change: function (e) {
                        changeStatus = 1;
                        var dataItem = e.sender.dataItem();
                        options.model.set("PackUnitName", dataItem.PackUnitName);
                        options.model.set("PackUnitID", dataItem.PackUnitID);
                    },
                });
        }


        // ------------End Grid Detail ddl List panel----------------
        // Delete Button
        $("#btnDelete").click(function () {
            deleteStatus = 1; //For  All dataset
            resetEditDeleteStatus = 3; //Delete Button
            // When Changes Data
            if (changeStatus == 1)
                OpenSaveChangesDialog();
                // When no Changes Data
            else {
                OpenConfirmationDialog();
            }
        });

        //Handling Delete event for PageDeailsGrid row
        function handleDeleteItem() {
            deleteStatus = 2;//For grid data
            var grid1 = $("#PageDetailGrid").data("kendoGrid");
            dataitem = (grid1.dataItem(grid1.select())); //Selected Row
            if (changeStatus == 0) {
                OpenConfirmationDialog();
            } else {
                resetEditDeleteStatus = 3;
                OpenSaveChangesDialog();
            }
        };
        //Handling Yes button click for grid row deletion
        $('#btnConfirmationOK').click(function () {
            if (deleteStatus == 1) {
                if ($("#RequisitionID").val() != "") {
                    $.ajax({
                        url: '@Url.Action("DeletedChemPurcReq", "ChemPurcReq")',
                        type: 'POST',
                        data: JSON.stringify({ "requisitionId": $("#RequisitionID").val() }),
                        contentType: 'application/json;',
                        dataType: 'json',
                        success: function (respnse) {
                            if (respnse.msg.Type == 2) {
                                $('#MessageText').html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                //ClearOperationalMessage();
                                ResetOnlyParentData();
                                $(".txtCommandBox").val("");
                                $(".RequiredTextBox").css("border-color", "");
                                $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
                            } else {
                                $("#MessageText").html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                            }
                        }
                    });
                }
                $(".RequiredTextBox").css("border-color", "");
                CloseConfirmationDialog();
            } else if (deleteStatus == 2) {
                if (dataitem.RequisitionItemID != "") {
                    $.ajax({
                        url: '@Url.Action("DeletedChemPurcReqItem", "ChemPurcReq")',
                        type: 'POST',
                        data: JSON.stringify({ "requisitionItemId": dataitem.RequisitionItemID, recordStatus: recordStatus }),
                        contentType: 'application/json;',
                        dataType: 'json',
                        success: function (respnse) {
                            if (respnse.msg.Type == 2) {
                                $('#MessageText').html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                $("#PageDetailGrid").data("kendoGrid").dataSource.remove(dataitem);
                            } else {
                                $("#MessageText").html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                            }
                        }
                    });
                } else {
                    $("#PageDetailGrid").data("kendoGrid").dataSource.remove(dataitem);
                }
                $(".RequiredTextBox").css("border-color", "");
                CloseConfirmationDialog();
            }
        });

        //Handling No button click for grid row deletion
        $('#btnConfirmationCancel').click(function () {
            dataitem = {};
            CloseConfirmationDialog();
        });

        // Click Save Chages Popup No Button
        $("#btnSaveChangeWindowOk").click(function () {
            if (resetEditDeleteStatus == 1) { // Reset
                ResetOnlyMasterPageData();
                $(".RequiredTextBox").css("border-color", "");
                $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
                changeStatus = 0;
                CloseSaveChangesDialog();
            } else if (resetEditDeleteStatus == 2) { // Search
                ResetOnlyMasterPageData();
                $(".RequiredTextBox").css("border-color", "");
                $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
                changeStatus = 0;
                CloseSaveChangesDialog();
                LoadSearchGrid();
                SelectedItemOfListOfValue('SearchWindowGrid');
                SearchWindow.open();
            } else if (resetEditDeleteStatus == 3) { // Delete Button
                if (deleteStatus == 1) {
                    if ($("#RequisitionID").val() != "") {
                        $.ajax({
                            url: '@Url.Action("DeletedChemPurcReq", "ChemPurcReq")',
                            type: 'POST',
                            data: JSON.stringify({ "requisitionId": $("#RequisitionID").val() }),
                            contentType: 'application/json;',
                            dataType: 'json',
                            success: function (respnse) {
                                if (respnse.msg.Type == 2) {
                                    $('#MessageText').html(respnse.msg.Msg);
                                    $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                    ClearOperationalMessage();
                                    ResetOnlyMasterPageData();
                                    $(".RequiredTextBox").css("border-color", "");
                                    $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
                                } else {
                                    $("#MessageText").html(respnse.msg.Msg);
                                    $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                }
                            }
                        });
                    }
                    $(".RequiredTextBox").css("border-color", "");
                    CloseSaveChangesDialog();
                } else if (deleteStatus == 2) {
                    if (dataitem.RequisitionItemID != "") {
                        $.ajax({
                            url: '@Url.Action("DeletedChemPurcReqItem", "ChemPurcReq")',
                            type: 'POST',
                            data: JSON.stringify({ "requisitionItemId": dataitem.RequisitionItemID }),
                            contentType: 'application/json;',
                            dataType: 'json',
                            success: function (respnse) {
                                if (respnse.msg.Type == 2) {
                                    $('#MessageText').html(respnse.msg.Msg);
                                    $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                    $("#PageDetailGrid").data("kendoGrid").dataSource.remove(dataitem);
                                } else {
                                    $("#MessageText").html(respnse.msg.Msg);
                                    $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                }
                            }
                        });
                    } else {
                        $("#PageDetailGrid").data("kendoGrid").dataSource.remove(dataitem);
                    }
                    $(".RequiredTextBox").css("border-color", "");
                    CloseSaveChangesDialog();
                }
            }
        });

        // Click Save Chages Popup Cancel Button
        $("#btnSaveChangeWindowCancel").click(function () {
            CloseSaveChangesDialog();
        });

        CheckUnSavedOnlyMasterData();

        ClearAllData();
        CheckRecordStatusForButton("NCF");


    }); //End of Document.Ready()







    //--------------------------------------End of Defining Datasource & Dropdown--------------------------------------------

    //---------------------------------------------Start of defining popup Window-----------------------------------------------


    var chemicalWindow = $('#ChemicalWindow').kendoWindow({
        actions: ["Minimize", "Maximize", "Close"],
        visible: false,
        width: "auto",
        height: "auto",
        title: "List Of Chemical",
        position: { top: 50, left: 5 },
        modal: true,
        draggable: true
    }).data('kendoWindow');


    var supplierWindow = $('#SupplierWindow').kendoWindow({
        actions: ["Minimize", "Maximize", "Close"],
        visible: false,
        width: "auto",
        height: "auto",
        title: "List Of Supplier",
        position: { top: 50, left: 5 },
        modal: true,
        draggable: true
    }).data('kendoWindow');
    //---------------------------------------------End of defining popup Window-----------------------------------------------






    //Manufacturer search window definition
    var SupplierSearchGridDataSource = new kendo.data.DataSource({
        schema: {
            model: {
                id: "ItemID",
                fields: {
                    SupplierID: { editable: false },
                    SupplierCode: { editable: false },
                    SupplierName: { editable: false },
                    SupplierType: { editable: false },
                }
            }
        },
        transport: {
            read: '@Url.Action("GetAllManufacturer", "CommonChemical")', //Need to change to Manufacturer
            type: 'GET',
            data: 'JSON'
        },
        pageSize: 50
    });
    var ManufacturerSearchGrid = $("#ManufacturerSearchWindowGrid").kendoGrid({
        dataSource: SupplierSearchGridDataSource,
        pageable: true,
        editable: true,
        selectable: "row",
        navigatable: true,
        filterable: true,
        sortable: true,
        //height: 150,
        columns: [
            { field: "SupplierCode", title: "Code", width: "30px" },
            { field: "SupplierName", title: "Name", width: "30px" },
            { field: "SupplierType", title: "Type", width: "30px" }
        ]
    });
    var ManufacturerWindow = $('#ManufacturerSearchWindow').kendoWindow({
        actions: ["Minimize", "Maximize", "Close"],
        visible: false,
        width: "600px",
        height: "auto",
        title: "Manufacturer Search",
        position: { top: 50, left: 5 },
        modal: true,
        draggable: false
    }).data('kendoWindow'); //Manufacturer search window definition end
    // Manufacturer search window events
    function ManufacturerSearchEvents() {
        var gridSupplierSearch = $("#ManufacturerSearchWindowGrid").data("kendoGrid");
        var selectedSupplier = (gridSupplierSearch.dataItem(gridSupplierSearch.select())); //Selected Row
        var gridCiItem = $("#PageDetailGrid").data("kendoGrid");
        var selectedCiigItem = (gridCiItem.dataItem(gridCiItem.select()));

        //selectedCiigItem.set("SupplierID", selectedSupplier.SupplierID);
        selectedCiigItem.set("ManufacturerID", selectedSupplier.SupplierID);
        selectedCiigItem.set("ManufacturerName", selectedSupplier.SupplierName);
        changeStatus = 1;
    }
    $("#btnManufacturerWindowOK").click(function () {
        ManufacturerSearchEvents();
        ManufacturerWindow.close();
    });
    $("#ManufacturerSearchWindowGrid").dblclick(function () {
        ManufacturerSearchEvents();
        ManufacturerWindow.close();
    });
    $("#ManufacturerSearchWindowGrid").keyup(function (e) {
        var gridSupplierSearch = $("#ManufacturerSearchWindowGrid").data("kendoGrid");
        var selectedSupplier = (gridSupplierSearch.dataItem(gridSupplierSearch.select())); //Selected Row
        if (selectedSupplier != null) {
            if (e.keyCode == 13) {
                ManufacturerSearchEvents();
                ManufacturerWindow.close();
            }
        }
    });
    $("#btnManufacturerWindowCancel").click(function () {
        ManufacturerWindow.close();
    });
    $("#ManufacturerSearchWindow").keyup(function (e) {
        if (e.keyCode == 27) {
            ManufacturerWindow.close();
        }
    }); // Manufacturer search window events End

    //-------------------------------------------------Common Function--------------------------------------------------------

    //To select the first row as default & to clear the filter while loading the grid
    function listOfValueGridEvent(gridName) {
        var grid = $('#' + gridName).data("kendoGrid");
        //Reload Grid
        grid.dataSource.read();
        //Clear Filter
        $('#' + gridName).data("kendoGrid").dataSource.filter([]);
        //Select First Row
        $('#' + gridName).data().kendoGrid.bind('dataBound', function (e) {
            this.element.find('tbody tr:first').addClass('k-state-selected');
        });
    }

    $("#PageDetailGrid").on('input', function () {
        changeStatus = 1;
    });

    //------------------------------------------------- End Common Function--------------------------------------------------------


    //-------------------------------------Start CRUD Opreation--------------------------------------------------

    // Declare Object
    var DetailItemModel = { "RequisitionItemID": "", "ItemID": "", "SafetyStock": "", "PipelineQty": "", "TotalQty": "", "ReorderLevel": "", "ProdReqQty": "", "SizeID": "", "PackUnitID": "", "PackQty": "", "RequisitionQty": "", "RequisitionUnit": "", "ManufacturerID": "" };
    var MasterDataModel = { "RequisitionID": "", "RequisitionNo": "", "RequisitionCategory": "", "RequisitionType": "", "ReqRaisedOn": "", "ReqRaisedBy": "", "RequiredByTime": "", "RequisitionTo": "", "RequisitionFrom ": "", "ChemPurcReqItems": [] };
    var saveStatus = 1;

    function SaveData() {
        saveStatus = 1;
        CheckRequiredTextBoxMaxLength('RequisitionCategory', 20);
        CheckRequiredTextBoxMaxLength('RequisitionType', 20);
        CheckRequiredTextBoxMaxLength('RequisitionFrom', 50);
        //CheckRequiredTextBoxMaxLength('SupplierCode', 20);
        CheckRequiredTextBoxMaxLength('RequisitionFrom', 20);
        CheckRequiredTextBoxMaxLength('RequisitionDate', 15);

        if (saveStatus == 1) {
            MasterDataModel.RequisitionID = $('#RequisitionID').val();
            MasterDataModel.RequisitionNo = $('#RequisitionNo').val();
            MasterDataModel.RequisitionCategory = $('#RequisitionCategory').val();
            MasterDataModel.RequisitionType = $('#RequisitionType').val();
            MasterDataModel.ReqRaisedOn = $('#RequisitionDate').val();
            MasterDataModel.ReqRaisedBy = $('#ReqRaisedByName').val();
            MasterDataModel.RequiredByTime = $('#RequiredByTime').val();
            MasterDataModel.RequisitionFrom = $('#RequisitionFrom').val();
            MasterDataModel.RequisitionTo = $('#SupplierID').val();

            var dataSource = $("#PageDetailGrid").data("kendoGrid").dataSource;
            var data = dataSource.data(); // Get Detail Grid Data
            MasterDataModel.ChemPurcReqItems = [];
            if (dataSource.hasChanges) {
                for (var i = 0; i <= data.length - 1; i++) {

                    if (data[i].dirty) {
                        if ((data[i].RequisitionQty == 0) || (data[i].UnitID == "")) {
                            //(data[i].PackQty == "")
                            checkGridData = 0;
                            break;
                        }
                        DetailItemModel.RequisitionItemID = data[i].RequisitionItemID;
                        DetailItemModel.ItemID = data[i].ItemID;
                        DetailItemModel.SizeID = data[i].SizeID;
                        DetailItemModel.PackUnitID = data[i].PackUnitID;
                        DetailItemModel.PackQty = data[i].PackQty;
                        DetailItemModel.RequisitionQty = data[i].RequisitionQty;
                        DetailItemModel.ManufacturerID = data[i].ManufacturerID;
                        DetailItemModel.RequisitionUnit = data[i].UnitID;

                        MasterDataModel.ChemPurcReqItems.push(DetailItemModel);
                        DetailItemModel = { "RequisitionItemID": "", "ItemID": "", "SafetyStock": "", "PipelineQty": "", "TotalQty": "", "ReorderLevel": "", "ProdReqQty": "", "SizeID": "", "PackUnitID": "", "PackQty": "", "RequisitionQty": "", "RequisitionUnit": "", "ManufacturerID": "" };
                    }
                }
            }
            $("#divLoading").show();
            if (changeStatus == 1) {
                if (checkGridData == 1) {
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("ChemPurcReq", "ChemPurcReq")',
                        data: JSON.stringify(MasterDataModel),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        cache: false,
                        success: function (respnse) {
                            $("#divLoading").hide();
                            if (respnse.msg.Type == "2") {
                                $('#MessageText').html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                $("#RequisitionID").val(respnse.msg.ReturnId);
                                $("#RequisitionNo").val(respnse.msg.ReturnCode);
                                changeStatus = 0;
                                $.ajax({
                                    url: '@Url.Action("GetRequisitionItemList", "ChemPurcReq")',
                                    type: 'GET',
                                    data: { requisitionId: $("#RequisitionID").val() },
                                    success: function (datasc) {
                                        $("#PageDetailGrid").data("kendoGrid").dataSource.data(datasc);
                                        DisplayRequsitionTotalQty();
                                    }
                                });
                            } else if (respnse.msg.Type == 3) {
                                $('#MessageText').html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                                $("#RequisitionID").val(respnse.msg.ReturnId);
                                $("#RequisitionNo").val(respnse.msg.ReturnCode);
                                changeStatus = 0;
                                $.ajax({
                                    url: '@Url.Action("GetRequisitionItemList", "ChemPurcReq")',
                                    type: 'GET',
                                    data: { requisitionId: $("#RequisitionID").val() },
                                    success: function (datasc) {
                                        $("#PageDetailGrid").data("kendoGrid").dataSource.data(datasc);
                                        DisplayRequsitionTotalQty();
                                    }
                                });
                            }
                            else {
                                $('#MessageText').html(respnse.msg.Msg);
                                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                            }
                        }
                    });
                    MasterDataModel = { "RequisitionID": "", "RequisitionNo": "", "RequisitionCategory": "", "RequisitionType": "", "ReqRaisedOn": "", "ReqRaisedBy": "", "RequiredByTime": "", "RequisitionTo": "", "RequisitionFrom ": "", "ChemPurcReqItems": [] };
                }
                    // Wrong Grid Data
                else {
                    $("#divLoading").hide();
                    $("#MessageText").html("Please Enter the Required Grid Data Properly.");
                    $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                    checkGridData = 1;
                }
            }
                // No Changes Exiting Data
            else {
                $("#divLoading").hide();
                $("#MessageText").html("No Changes to Save.");
                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
            }
        }
    }


    //Check and confrim form
    function checkNconfirm(state) {
        $("#divLoading").show();
        var requisitionId = $("#RequisitionID").val();
        if (state == "chk") {

            var chkComment = $("#checkComment").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("CheckData", "ChemPurcReq")',
                dataType: 'JSON',
                data: JSON.stringify({ requisitionId: requisitionId, chkComment: chkComment }),
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    if (response.msg.Type == 2) {
                        $('#MessageText').html(response.msg.Msg);
                        $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                        saveStatus = 1;
                        CheckRecordStatusForButton("CHK");
                        $("#divLoading").hide();
                        //ClearAllData();
                    }
                    else {
                        $("#divLoading").hide();
                        $('#MessageText').html(response.msg.Msg);
                        $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                    }
                },
                error: function () {
                }
            });
        }
        if (state == "cnf") {
            var cnfComment = $("#confirmComment").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ConfirmData", "ChemPurcReq")',
                dataType: 'JSON',
                data: JSON.stringify({ requisitionId: requisitionId, cnfComment: cnfComment }),
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    if (response.msg.Type == 2) {
                        $('#MessageText').html(response.msg.Msg);
                        $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                        saveStatus = 1;
                        CheckRecordStatusForButton("CNF");
                        $("#divLoading").hide();
                        //ClearAllData();
                    }
                    else {
                        $("#divLoading").hide();
                        $('#MessageText').html(response.msg.Msg);
                        $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'left' });
                    }
                },
                error: function () {
                }
            });
        }
    }//Check and confrim form end
    //Check and confrim form acivation
    $("#btnCheck").click(function () {
        if (changeStatus == 1 && saveStatus != 1) {
            $('#MessageText').html("Please save the changes you have made.");
            $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
        } else {
            if ($("#RequisitionID").val() != "") {
                checkNconfirm("chk");
            } else {
                $('#MessageText').html("Please save first.");
                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
            }
        }
    });
    $("#btnConfirm").click(function () {
        if (changeStatus == 1 && saveStatus != 1) {
            $('#MessageText').html("Please save the changes you have made.");
            $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
        } else {
            if ($("#RequisitionID").val() != "") {
                checkNconfirm("cnf");
            } else {
                $('#MessageText').html("Please save first.");
                $("#MessageText").css({ 'color': 'red', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
            }
        }
    });//Check and confrim form acivation end



    //-------------------------------------End Start CRUD Opreation--------------------------------------------------

    //------------------------------------Start of Button Event----------------------------------------

    function ClearAllData() {

        // ClearOperationalMessage();
        ResetOnlyParentData();
        $(".RequiredTextBox").css("border-color", "");
        $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
    }

    // Reset Data
    $("#btnReset").click(function () {
        resetEditDeleteStatus = 1; //Reset Button

        // When Changes Data
        if (changeStatus == 1)
            OpenSaveChangesDialog();
            // When no Changes Data
        else {
            $('#RequisitionID').val("");
            $('#RequisitionDate').val("");
            CheckRecordStatusForButton("NCF");
            ClearOperationalMessage();
            ResetOnlyMasterPageData();
            $(".RequiredTextBox").css("border-color", "");
            $("#PageDetailGrid").data("kendoGrid").dataSource.data([]);
        }
    });

    // For Search button work

    $("#btnSearch").click(function () {
        resetEditDeleteStatus = 2;
        // When Changes Data
        if (changeStatus == 1)
            OpenSaveChangesDialog();
            // When no Changes Data
        else {
            ClearOperationalMessage();
            $(".RequiredTextBox").css("border-color", "");
            LoadSearchGrid();
            SelectedItemOfListOfValue('SearchWindowGrid');
            SearchWindow.open();
        }
    });


    var SearchGridDataSource = new kendo.data.DataSource({
        schema: {
            model: {
                id: "RequisitionID",
                fields: {
                    RequisitionID: { editable: false },
                    RequisitionNo: { editable: false },
                    RequisitionCategory: { editable: false },
                    RequisitionCategoryValue: { editable: false },
                    RequisitionType: { editable: false },
                    RequisitionTypeValue: { editable: false },
                    ReqRaisedOn: { editable: false },
                    RequisitionFrom: { editable: false },
                    StoreName: { editable: false },
                    RequisitionTo: { editable: false },
                    SupplierCode: { editable: false },
                    SupplierName: { editable: false },
                    RequiredByTime: { editable: false },
                    ReqRaisedBy: { editable: false },
                    ReqRaisedByName: { editable: false },
                    RecordStatus: { editable: false }
                }
            }
        },
        pageSize: 50
    });

    var SearchGrid = $("#SearchWindowGrid").kendoGrid({
        dataSource: SearchGridDataSource,
        pageable: true,
        groupable: true,
        editable: true,
        selectable: "row",
        navigatable: true,
        //filterable: true,
        filterable: {
            extra: false,
            operators: {
                string: {
                    startswith: "Starts with",
                    contains: "Contains"
                }
            }
        },
        sortable: true,
        height: 400,
        columns: [
            { field: "RequisitionID", hidden: true, title: "Requisition ID", width: "30px" },
            { field: "RequisitionNo", title: "Requisition No", width: "60px" },
            { field: "RequisitionCategory", title: "Requisition Category", width: "60px" },
            { field: "RequisitionCategoryValue", hidden: true },
            { field: "RequisitionType", title: "Requisition Type", width: "60px" },
            { field: "RequisitionTypeValue", hidden: true },
            { field: "ReqRaisedOn", title: "Requisition Date", width: "60px" },
            { field: "RequisitionFrom", hidden: true },
            { field: "StoreName", hidden: false, title: "Store Name", width: "80px" },
            { field: "RequisitionTo", hidden: true },
            { field: "SupplierCode", hidden: true },
            { field: "SupplierName", hidden: false, title: "Supplier Name", width: "100px" },
            { field: "RequiredByTime", hidden: true },
            { field: "ReqRaisedBy", hidden: true },
            { field: "ReqRaisedByName", hidden: true },
            { field: "RecordStatus", title: "Record Status", width: "60px" }
        ]
    });

    var SearchWindow = $('#SearchWindow').kendoWindow({
        actions: ["Minimize", "Maximize", "Close"],
        visible: false,
        width: "auto",
        height: "auto",
        title: "Chemical Purchase Requisition Search",
        position: { top: 50, left: 5 },
        modal: true,
        draggable: true
    }).data('kendoWindow');




    function LoadSearchGrid() {
        $.ajax({
            url: '@Url.Action("GetAllNcfChemPurcReqList", "ChemPurcReq")',
            type: 'GET',
            data: { pageMode: "ENT" },
            success: function (data33) {
                $("#SearchWindowGrid").data("kendoGrid").dataSource.data(data33);
            }
        });
    }

    function SearchWindowEvents() {
        var grid = $("#SearchWindowGrid").data("kendoGrid");
        var selectedItem = (grid.dataItem(grid.select())); //Selected Row
        $("#RequisitionID").val(selectedItem.RequisitionID);
        $("#RequisitionNo").val(selectedItem.RequisitionNo);
        $("#RequisitionCategory").val(selectedItem.RequisitionCategoryValue);
        $("#RequisitionType").val(selectedItem.RequisitionTypeValue);
        $("#RequisitionFrom").val(selectedItem.RequisitionFrom);
        $("#StoreName").val(selectedItem.StoreName);
        //Check
        $("#RequisitionTo").val(selectedItem.RequisitionTo);

        $("#SupplierID").val(selectedItem.RequisitionTo);
        $("#SupplierCode").val(selectedItem.SupplierCode);

        $("#SupplierName").val(selectedItem.SupplierName);

        $("#RequiredByTime").val(selectedItem.RequiredByTime);

        $("#RequisitionDate").val(selectedItem.ReqRaisedOn);
        $("#ReqRaisedByName").val(selectedItem.ReqRaisedBy);
        $("#NameWithDesignation").val(selectedItem.ReqRaisedByName);
        recordStatus = selectedItem.RecordStatus;
        CheckRecordStatusForButton(recordStatus);
        $.ajax({
            url: '@Url.Action("GetRequisitionItemList", "ChemPurcReq")',
            type: 'GET',
            data: { requisitionId: $("#RequisitionID").val() },
            success: function (datasc) {
                $("#PageDetailGrid").data("kendoGrid").dataSource.data(datasc);

                var totalReqQty = 0;
                var itemGridDataSource = $("#PageDetailGrid").data("kendoGrid").dataSource;
                var gridData = itemGridDataSource.data();

                for (i = 0; i < gridData.length ; i++) {
                    totalReqQty += parseInt(gridData[i].RequisitionQty);
                }
                $("#txtTotalRequisitionQty").val(totalReqQty.toFixed(2));
            }
        });
    }

    $('#btnSearchWindowOK').click(function () {
        SearchWindowEvents();
        SearchWindow.close();

    });
    $('#btnSearchWindowCancel').click(function () {
        SearchWindow.close();
    });
    $("#SearchWindow").dblclick(function () {
        SearchWindowEvents();
        SearchWindow.close();

    });
    $("#SearchWindow").keyup(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            SearchWindowEvents();
            SearchWindow.close();
        }
            // Close Window with escape key
        else if (keycode == '27') {
            SearchWindow.close();
        }
        event.stopPropagation();
    });

    //------------------------------------End of Button Event----------------------------------------


</script>
