@{
    ViewBag.Title = "Export C&F Bill Documentation";
    ViewBag.SearchTitle = "CnfBill No";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/bootstrap.js"></script>
@Html.Partial("~/Views/Common/_FormHeader.cshtml")



<div class="row">
    <div class="FormBody">

        <input type="hidden" id="CnfBillID" name="CnfBillID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="BuyerID" name="BuyerID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="LCID" name="LCID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="BuyerAddressID" name="BuyerAddressID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="PIID" name="PIID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="PLID" name="PLID" value="" placeholder="" readonly="readonly" />
        <input type="hidden" id="CIID" name="CIID" value="" placeholder="" readonly="readonly" />
        @*<input type="hidden" id="BuyerID" name="BuyerID" value="" placeholder="" readonly="readonly" />*@

        <div class="row">
            <div class="col-lg-1">
                <label>C&F Agent</label>
            </div>
            <div class="col-lg-3">
                <input type="text" id="BuyerCode" name="BuyerCode" tabindex="1" class="txtBox RequiredTextBox" readonly="readonly" placeholder="Press F9" value="" style="width: 80px;" />
                <input type="text" id="BuyerName" name="BuyerName" class="txtBox RequiredTextBox" readonly="readonly" value="" style="width: 160px;" />
            </div>

            <div class="col-lg-1">
                <label>C&F Adds.</label>
            </div>
            <div class="col-lg-3">
                <input type="text" id="Address" readonly="readonly" tabindex="2" name="Address" class="txtBox RequiredTextBox" value="" />
            </div>

            <div class="col-lg-1">
                <label>ContactPerson</label>
            </div>
            <div class="col-lg-3">
                <input type="text" id="ContactPerson" readonly="readonly" tabindex="2" name="ContactPerson" class="txtBox RequiredTextBox" value="" />
            </div>
        </div>

        <div class="row">
            <div class="col-lg-1">
                <label>ContactNo.</label>
            </div>
            <div class="col-lg-3">

                <input type="text" id="ContactNumber" name="ContactNumber" class="txtBox RequiredTextBox" readonly="readonly" value="" style="width:246px;" />
            </div>

            <div class="col-lg-1">
                <label>Email</label>
            </div>
            <div class="col-lg-3">
                <input type="text" id="EmailAddress" readonly="readonly" tabindex="2" name="EmailAddress" class="txtBox RequiredTextBox" value="" />
            </div>

            <div class="col-lg-1">
                <label>Phone No.</label>
            </div>
            <div class="col-lg-3">
                <input type="text" id="PhoneNo" readonly="readonly" tabindex="2" name="PhoneNo" class="txtBox RequiredTextBox" value="" />
            </div>
        </div>

    </div>

    
        <div class="FormBody">
                <div class="row">
                    <div class="col-lg-1" style="float:left">
                        <label>CI Ref No</label>
                    </div>
                    <div class="col-lg-3">
                        <input type="text" id="CIRefNo" name="CIRefNo" readonly="readonly" tabindex="5" class="txtBox RequiredTextBox" placeholder="Press F9" style="text-align:center; width:246PX" />
                    </div>

                    <div class="col-lg-1">
                        <label></label>
                    </div>
                    <div class="col-lg-3">
                        <input type="hidden" id="BuyerID" name="BuyerID" tabindex="3" class="txtBox RequiredTextBox" />
                    </div>


                    <div class="col-lg-1">
                        <label>PL No</label>
                    </div>
                    <div class="col-lg-3">
                        <input type="text" id="PLNo" name="PLNo" readonly="readonly" tabindex="6" class="txtBox RequiredTextBox" placeholder="" style="text-align:center;float:left" />
                    </div>
                </div>  


            <div class="row">
                <div class="col-lg-1" style="float:left">
                    <label>Bale No</label>
                </div>
                <div class="col-lg-3">
                    <input type="text" id="BalesNo" name="BalesNo" readonly="readonly" tabindex="5" class="txtBox RequiredTextBox" placeholder="" style="text-align:center; width:246PX" />
                </div>

                <div class="col-lg-1">
                    <label></label>
                </div>
                <div class="col-lg-3">
                    <input type="hidden" id="BuyerID" name="BuyerID" tabindex="3" class="txtBox RequiredTextBox" />
                </div>


                <div class="col-lg-1">
                    <label>Total Bales</label>
                </div>
                <div class="col-lg-3">
                    <input type="text" id="TotalBales" name="TotalBales" readonly="readonly" tabindex="6" class="txtBox RequiredTextBox" placeholder="" style="text-align:center;float:left" />
                </div>
            </div> 




        </div>







    


        <div class="FormBody">
            <div class="row">
                <div class="col-lg-1">
                    <label>CnfBill No</label>
                </div>
                <div class="col-lg-3">
                    <input type="text" id="CnfBillNo" name="CnfBillNo" tabindex="2" class="txtBox RequiredTextBox" placeholder="" style="text-align:center; width:246PX" />
                </div>

                <div class="col-lg-1">
                    @*<label>Ref CnfBill No</label>*@
                </div>
                <div class="col-lg-3">
                    @*<input type="text" id="RefCnfBillNo" name="RefCnfBillNo" tabindex="3" class="txtBox RequiredTextBox" />*@
                </div>

                <div class="col-lg-1">
                    <label>CnfBill Date</label>
                </div>
                <div class="col-lg-3">
                    <input type="text" id="CnfBillDate" name="CnfBillDate" tabindex="4" class="txtBox datePicker" placeholder="" />
                </div>

            </div>
        </div>


        <div class="FormBody">
            <div class="row ">
                <div class="col-lg-2">
                    <label>Bill of Entry No</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="BillOfEntryNo" name="BillOfEntryNo" tabindex="7" class="txtBox RequiredTextBox" placeholder="" style="width:352px;" />
                </div>


                <div class="col-lg-2">
                    <label>Assessment Value</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="AssesmentValue" name="AssesmentValue" class="txtBox RequiredTextBox" tabindex="9" placeholder="" style="width:352px;" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>Bill of Entry Date</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="BillOfEntryDate" name="BillOfEntryDate" tabindex="8" class="txtBox datePicker" placeholder="" style="width:352px;" />
                </div>


                <div class="col-lg-2">
                    <label>Remarks</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="CnfBillNote" name="CnfBillNote" class="txtBox " tabindex="10" placeholder="" style="width:352px" />
                </div>
            </div>
        </div>



        <div class="FormBody">

            <div class="row">
                <div class="col-lg-2">
                    <label>Currecncy</label>
                </div>
                <div class="col-lg-4">
                    <div id="CnfBillCurrency" tabindex="23">
                        @Html.DropDownList("Currency", (SelectList)ViewBag.Currency, new { style = "width: 351px;text-align:center" })
                    </div>
                </div>
            </div>

            <div class="row ">
                <div class="col-lg-2">
                    <label>Duty A/C Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="DutyAccountCharge" name="DutyAccountCharge" placeholder="0.00" onblur="TotalAmountCalcultaion()" class="txtBox RequiredTextBox" tabindex="11" style="width:352px;text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Examine Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="ExamineCharge" name="ExamineCharge" placeholder="0.00" onblur="TotalAmountCalcultaion()" class="txtBox " tabindex="17" style="width:352px;text-align:right" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>Port Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="PortCharge" name="PortCharge" class="txtBox" tabindex="12" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Special Delivary Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="SpecialDeliveryCharge" name="SpecialDeliveryCharge" class="txtBox " tabindex="18" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>Shipping Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="ShippingCharge" name="ShippingCharge" class="txtBox " tabindex="13" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Amendment Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="AmendmentCharge" name="AmendmentCharge" class="txtBox " tabindex="19" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>Berth Operator Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="BerthOperatorCharge" name="BerthOperatorCharge" class="txtBox " tabindex="14" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Chemical Test Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="ChemicalTestCharge" name="ChemicalTestCharge" class="txtBox " tabindex="20" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>NOC Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="NOCCharge" name="NOCCharge" class="txtBox" tabindex="15" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Agency Commission</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="AgencyCommission" name="AgencyCommission" class="txtBox " tabindex="21" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <label>Stamp Charge</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="StampCharge" name="StampCharge" class="txtBox " tabindex="16" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px; text-align:right" />
                </div>


                <div class="col-lg-2">
                    <label>Total Amount</label>
                </div>
                <div class="col-lg-4">
                    <input type="text" id="TotalAmount" name="TotalAmount" class="txtBox "  tabindex="22" placeholder="0.00" onblur="TotalAmountCalcultaion()" style="width:352px;text-align:right" />
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="FormBody">
                    <div class="row">
                        <div class="col-lg-4">
                            <label>Exchange Currecncy</label>
                        </div>
                        <div class="col-lg-8">
                            <div id="ExchangeCurrency" onblur=" return IsNumber('ExchangeCurrency');">
                                @*@Html.DropDownList("Currency")*@
                                @Html.DropDownList("Currency", (SelectList)ViewBag.Currency, new { style = "width: 344px;;text-align: center" })
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-4">
                            <label>Exchange Rate</label>
                        </div>
                        <div class="col-lg-8">
                            <div id="ExchangeCurrency">
                                <input type="text" id="ExchangeRate" name="ExchangeRate" style="width: 344px; text-align: right" value="" placeholder="0.00" onblur="ExchangeAmountCalcultaion();" />
                                @*@Html.DropDownList("Currency")*@
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-4">
                            <label>Exchange Amt.</label>
                        </div>
                        <div class="col-lg-8">
                            <input type="text" id="ExchangeValue" name="ExchangeValue" style="width: 344PX; text-align: right" value="" readonly="readonly" placeholder="0.00" onblur="" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="FormBody">
                    <div class="row">
                        <div class="col-lg-4">
                            <label>Remarks</label>
                        </div>
                        <div class="col-lg-8">
                            <textarea style="width: 344PX" id="Remarks" name="Remarks"></textarea>
                            @*<input type="button" id="btnChecked" name="btnChecked" value="Checked" />*@
                            <input type="button" id="btnConfirm" class="" name="btnConfirm" value="Confirmed" />
                        </div>
                    </div>

                </div>
            </div>
        </div>





    </div>


        <div id="BuyerIDWindow" style="display: none;">
            @*<p>Buyer:<input type="text" id="txtOpeningBank" style="width: 250px;" placeholder="Search Bank Name.." /><input type="button" id="btnOpeningGridSearch" value="Search" /></p>*@

            <div id="BuyerIDGrid" class="PopUpGrid">
            </div>
            <input type="button" id="btnBuyerIDWindowCancel" class="PopUpButton" value="Cancel" />
            <input type="button" id="btnBuyerIDWindowOK" class="PopUpButton" value="OK" />
        </div>

        <div id="LCIDWindow" style="display: none;">
            @*<p>LC No.:<input type="text" id="LCNo" style="width: 250px;" placeholder="Search Bank Name.." /><input type="button" id="btnOpeningGridSearch" value="Search" /></p>*@
            <div id="LCIDGrid" class="PopUpGrid">
            </div>
            <input type="button" id="btnLCIDWindowCancel" class="PopUpButton" value="Cancel" />
            <input type="button" id="btnLCIDWindowOK" class="PopUpButton" value="OK" />
        </div>



        <div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
        top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
        opacity: .8; filter: alpha(opacity=70);display:none">
            <p style="position: absolute; top: 50%; left: 42%; color: White;">
                Loading, please wait...<img src="../../images/ajax-loading.gif">
            </p>
        </div>

        <div id="SaveChangeWindow" style="display: none;">
            <p><h5>Data will be lost if you continue.</h5></p>
            <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowOk" value="OK" />
            <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowCancel" value="Cancel" />
        </div>

        <div id="SaveChangeWindow" style="display: none;">
            <p><h5>Data will be lost if you continue.</h5></p>
            <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowOk" value="OK" />
            <input type="button" class="ThreeButtonWindow" id="btnSaveChangeWindowCancel" value="Cancel" />
        </div>
        <div id="ConfirmWindow" style="display: none;">
            <p><h5 style="color: red;">At First Save this Record.</h5></p>
            <input type="button" style="height: 25px; width: 60px; margin-left: 50px; float: left;" id="btnConfirmationClose" value="Close" />
        </div>
        <div id="DeleteLimInfoListConfirmWindow" style="display: none;">
            <input type="button" style="height: 25px; width: 60px; margin-left: 50px; float: left;" id="btnDeleteLimInfoListOK" value="OK" />
            <input type="button" style="height: 25px; width: 60px; margin-left: 50px; float: left;" id="btnDeleteLimInfoListCancel" value="Cancel" />
        </div>

        <script type="text/javascript">
            $("#LCID").val('');
            $("#LimID").val('');
            //$("#CnfBillDate").val('');
            var saveStatus = 1;
            var changeStatus = 0; // any change textbox/Dropdown/Grid
            var resetEditStatus = 0;
            var dataitem = {};

            $(document).ready(function () {




                NumericAndDecimalValue('AssesmentValue');
                NumericAndDecimalValue('DutyAccountCharge');
                NumericAndDecimalValue('PortCharge');
                NumericAndDecimalValue('ShippingCharge');
                NumericAndDecimalValue('BerthOperatorCharge');
                NumericAndDecimalValue('NOCCharge');
                NumericAndDecimalValue('ExamineCharge');
                NumericAndDecimalValue('SpecialDeliveryCharge');
                NumericAndDecimalValue('AmendmentCharge');
                NumericAndDecimalValue('ChemicalTestCharge');
                NumericAndDecimalValue('AgencyCommission');
                NumericAndDecimalValue('ExchangeRate');
                NumericAndDecimalValue('ExchangeValue');
                NumericAndDecimalValue('TotalAmount');
                NumericAndDecimalValue('StampCharge');

                $("#btnChecked").css("display", "block");
                $("#btnConfirm").css("display", "block");
                $("#btnConfirm").removeAttr('disabled');
                $("#btnChecked").removeAttr('disabled');
                $("select").addClass("select");

                $(".SetFocus").focus();
                // create DatePicker from input HTML element
                $(".datePicker").kendoDatePicker({
                    format: "{0:dd/MM/yyyy}",
                    value: new Date(),
                    max: new Date() // sets max date to Jan 1st, 2013
                });
            });


            //********************** START DOCUMENT.READY FUNCTION ******************************//

            $(document).ready(function () {
                $(document.body).keypress(function (e) {
                    if ($("#BankName").is(":focus")) {
                        if (e.keyCode == 120) {

                            $("#divLoading").show();

                            $.ajax({
                                url: '@Url.Action("GetLCBankList", "EXPLCOpening")',
                                type: "GET",
                                data: { bankCategory: "BNK", bankType: "FRN" },
                                dataType: "JSON",
                                success: function (data33) {
                                    $("#LCOpeningBankGrid").data("kendoGrid").dataSource.data(data33);
                                },
                                complete: function (data) {
                                    $("#divLoading").hide();
                                }
                            });
                            SelectedItemOfListOfValue('LCOpeningBankGrid');
                            LCOpeningBankWnicow.open();
                        }
                    }
                });


                $(document.body).keypress(function (e) {
                    if ($("#PINo").is(":focus")) {
                        if (e.keyCode == 120) {
                            $("#divLoading").show();
                            $.ajax({
                                url: '@Url.Action("GetPIInfo", "EXPLCOpening")',
                                type: "GET",
                                dataType: "JSON",
                                success: function (data33) {
                                    $("#LCPIGrid").data("kendoGrid").dataSource.data(data33);
                                },
                                complete: function (data) {
                                    $("#divLoading").hide();
                                }
                            });
                            SelectedItemOfListOfValue('LCPIGrid');
                            LCPIWindow.open();
                        }
                    }
                });
            });

            //********************** END DOCUMENT.READY FUNCTION ******************************//

            function SelectedItemOfListOfValue(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                grid.dataSource.read();
                $('#' + gridName).data("kendoGrid").dataSource.filter([]);
                $('#' + gridName).data().kendoGrid.bind('dataBound', function (e) {
                    this.element.find('tbody tr:first').addClass('k-state-selected');
                });
            }


            //#################### Exchange Rate #####################
            $('#ExchangeRate').click(function () {
                $('#ExchangeValue').blur();
                ExchangeAmountCalcultaion();
            });

            //##################### TotalAmountCalculation ##########################

            function TotalAmountCalcultaion() {

                if (($("#DutyAccountCharge").val() != 0) &&
                    ($("#PortCharge").val() != 0)&&
                    ($("#ShippingCharge").val() != 0) &&
                    ($("#BerthOperatorCharge").val() != 0) &&
                    ($("#NOCCharge").val() != 0) &&
                    ($("#ExamineCharge").val() != 0) &&
                    ($("#SpecialDeliveryCharge").val() != 0) &&
                    ($("#AgencyCommission").val() != 0) &&
                    ($("#AmendmentCharge").val() != 0) &&
                    ($("#StampCharge").val() != 0) &&
                    ($("#ChemicalTestCharge").val() != 0))
                {
                    ($("#TotalAmount").val(((($("#DutyAccountCharge").val()) - 0)
                                                    + (($("#PortCharge").val()) - 0)
                                                    + (($("#ShippingCharge").val()) - 0)
                                                    + (($("#BerthOperatorCharge").val()) - 0)
                                                    + (($("#NOCCharge").val()) - 0)
                                                    + (($("#ExamineCharge").val()) - 0)
                                                    + (($("#SpecialDeliveryCharge").val()) - 0)
                                                    + (($("#AgencyCommission").val()) - 0)
                                                    + (($("#AmendmentCharge").val()) - 0)
                                                    + (($("#StampCharge").val()) - 0)
                                                    + (($("#ChemicalTestCharge").val()) - 0)).toFixed(2)));


                }
                else
                {
                    ($("#TotalAmount").val((($("#TotalAmount").val()) - 0).toFixed(2)));
                }
                

                ExchangeAmountCalcultaion();
            }



            function ExchangeAmountCalcultaion() {

                if (($("#TotalAmount").val() != "")) {
                    ($("#ExchangeValue").val((((($("#TotalAmount").val()) - 0)) * (($("#ExchangeRate").val()) - 0)).toFixed(2)));

                }
                else {
                    $("#ExchangeValue").val("");
                }
            }

            //************************* C&F Agent POP UP ************************************//

            var BuyerIDWindow = $('#BuyerIDWindow').kendoWindow({
                actions: ["Minimize", "Maximize", "Close"],
                visible: false,
                width: "700px",
                height: "auto",
                title: "List Of C&F Agent",
                position: { top: 100, left: 300 },
                modal: true,
                draggable: true
            }).data('kendoWindow');

            var BuyerIDDataSource = new kendo.data.DataSource({
                schema: {
                    model: {
                        id: "BuyerID",
                        fields: {
                            CnfBillID: { editable: false, hidden: true },
                            BuyerID: { editable: false, hidden: true },
                            BuyerCode: { editable: false },
                            BuyerName: { editable: false },
                            ContactPerson: { editable: false, hidden: true },
                            ContactNumber: { editable: false, hidden: true },
                            EmailAddress: { editable: false, hidden: true },
                            PhoneNo: { editable: false, hidden: true },
                            BuyerAddressID: { editable: false },
                            Address: { editable: false },
                            LCID: { editable: false, hidden: true }



                        }
                    }
                },
                pageSize: 10
            });

            var BuyerIDGrid = $("#BuyerIDGrid").kendoGrid({
                dataSource: BuyerIDDataSource,
                pageable: true,
                editable: true,
                selectable: "row",
                navigatable: true,
                filterable: true,
                sortable: true,
                height: 300,
                filterable: {
                    extra: false,
                    operators: {
                        string: {
                            startswith: "Starts with",
                            contains: "Contains"
                        }
                    }
                },
                columns: [
                      { field: "BuyerID", title: "Agent ID", hidden: true, width: "60px", filterable: false, sortable: false, hidden: true },
                      { field: "CnfBillID", title: "CnfBil ID", hidden: true, width: "60px", filterable: false, sortable: false, hidden: true },
                      { field: "BuyerCode", title: "Agent Code" },
                      { field: "BuyerName", title: "Agent Name" },
                      { field: "ContactPerson", title: "Contact Person" },
                      { field: "ContactNumber", title: "Contact Number", hidden: true },
                      { field: "EmailAddress", title: "Email Address", hidden: true },
                      { field: "PhoneNo", title: "Phone No" },
                      { field: "BuyerAddressID", title: "Agent Address ID ", hidden: true },
                      { field: "Address", title: "Address" },
                      { field: "LCID", title: "LC ID", hidden: true }
                ]
            });




            //Open PopUp by pressing F9 key
            $(document.body).keypress(function (e) {
                if ($("#BuyerCode").is(":focus")) {

                    if (e.keyCode == 120) {

                        $("#divLoading").show();
                        $.ajax({
                            url: '@Url.Action("GetCnFBuyerList", "EXPCnfBill")',
                            type: "GET",
                            //data: { bankCategory: "BNK", bankType: "LOC" },

                            dataType: "JSON",
                            success: function (data33) {
                                $("#divLoading").hide();
                                $("#BuyerIDGrid").data("kendoGrid").dataSource.data(data33);
                            }
                        });
                        SelectedItemOfListOfValue('BuyerIDGrid');
                        BuyerIDWindow.open();
                    }
                }
            });



            //Press Ok button after Select Data From PopUp
            $('#btnBuyerIDWindowOK').click(function () {
                ListOfValueCnFAgentGridEvent('BuyerIDGrid');
                BuyerIDWindow.close();
            });


            //Press Cancel button after Select Data From PopUp
            $('#btnBuyerIDWindowCancel').click(function () {
                BuyerIDWindow.close();
            });


            // Select Data through double Click From PopUp
            $("#BuyerIDWindow").dblclick(function () {
                ListOfValueCnFAgentGridEvent('BuyerIDGrid');
                BuyerIDWindow.close();
            });


            // Select Data through keypress From PopUp
            $("#BuyerIDWindow").keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    ListOfValueCnFAgentGridEvent('BuyerIDGrid');
                    BuyerIDWindow.close();
                }
                else if (keycode == '27') {
                    BuyerIDWindow.close();
                }
                event.stopPropagation();
            });



            //To Bring Data from List of Value Grid to Main Page
            function ListOfValueCnFAgentGridEvent(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                var selectedItem = (grid.dataItem(grid.select()));
                $.each(selectedItem, function (key, value) {
                    if (value != null && value != 0)
                        $('#' + key).val(value);
                });
                $("#BuyerID").val(selectedItem.BuyerID);
                $("#BuyerCode").val(selectedItem.BuyerCode);
                $("#LCID").val(selectedItem.LCID);
                $("#CnfBillID").val("");
                $("#CnfAgentID").val(selectedItem.BuyerID);

            }

            //Select Data from Pop up Grid
            function SelectedItemOfListOfValue(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                grid.dataSource.read();
                $('#' + gridName).data("kendoGrid").dataSource.filter([]);
                $('#' + gridName).data().kendoGrid.bind('dataBound', function (e) {
                    this.element.find('tbody tr:first').addClass('k-state-selected');
                });
            }

            //$("#btnReset").click(function () {
            //    $('.FormBody input[type=text]').val('');
            //    $('#MessageText').html('');
            //    $('.FormBody .datePicker').val(getISODateTime(new Date()));
            //    $('#btnSubmit').attr('disabled', false);
            //    $('#btnDelete').attr('disabled', false);
            //    location.reload();
            //});

            //************************* END OF C&F Agent POP UP ************************************//


            //************************* LC No. Popup *************************************//

            var LCIDWindow = $('#LCIDWindow').kendoWindow({
                actions: ["Minimize", "Maximize", "Close"],
                visible: false,
                width: "700px",
                height: "auto",
                title: "List Of CI No.",
                position: { top: 100, left: 300 },
                modal: true,
                filterable: true,
                draggable: true
            }).data('kendoWindow');
            var LCIDDataSource = new kendo.data.DataSource({
                schema: {
                    model: {
                        id: "CIID",
                        fields: {

                            PLID:   { editable: false, filterable: true },
                            PLNo:   { editable: false, filterable: true },
                            CIID:   { editable: false, filterable: true },
                            CIRefNo:   { editable: false, filterable: true },
                            BalesNo: { editable: false, filterable: true },
                            TotalBales: { editable: false, filterable: true },
                            BaleQty: { editable: false, filterable: true }
                        }
                    }
                },
                pageSize: 10
            });

            var LCIDGrid = $("#LCIDGrid").kendoGrid({
                dataSource: LCIDDataSource,
                pageable: true,
                editable: true,
                selectable: "row",
                navigatable: true,
                filterable: true,
                sortable: true,
                height: 300,
                filterable: {
                    extra: false,
                    operators: {
                        string: {
                            startswith: "Starts with",
                            contains: "Contains"
                        }
                    }
                },
                columns: [
                          { field: "LCID", title: "LCID", width: "60px", filterable: true, sortable: false, hidden: true },
                          { field: "CIID", title: "CIID", filterable: true, hidden: true },
                          { field: "PLID", title: "PLID", filterable: true, hidden: true },
                          { field: "LCNo", title: "LCNo", filterable: true, hidden: true },
                          { field: "CIRefNo", title: "CI Ref No", filterable: true },
                          { field: "PLNo", title: "PLNo", filterable: true },
                          { field: "BalesNo", title: "Bales No", filterable: true },
                          { field: "TotalBales", title: "Total Bales", filterable: true }
                ]
            });




            //Open PopUp by pressing F9 key
            $(document.body).keypress(function (e) {
                if ($("#CIRefNo").is(":focus")) {
                    if (e.keyCode == 120) {
                        $("#divLoading").show();
                        $.ajax({
                            url: '@Url.Action("GetLCNoList", "EXPCnfBill")',
                            type: "GET",
                            //data: { bankCategory: "BNK", bankType: "LOC" },
                            dataType: "JSON",
                            success: function (data33) {
                                $("#divLoading").hide();
                                $("#LCIDGrid").data("kendoGrid").dataSource.data(data33);
                            }
                        });
                        SelectedItemOfListOfValue('LCIDGrid');

                        LCIDWindow.open();
                    }
                }
            });



            //Press Ok button after Select Data From PopUp
            $('#btnLCIDWindowOK').click(function () {
                ListOfValueOpeningLCIDGridGridEvent('LCIDGrid');
                LCIDWindow.close();
            });


            //Press Cancel button after Select Data From PopUp
            $('#btnLCIDWindowCancel').click(function () {
                LCIDWindow.close();
            });


            // Select Data through double Click From PopUp
            $("#LCIDWindow").dblclick(function () {
                ListOfValueOpeningLCIDGridGridEvent('LCIDGrid');
                LCIDWindow.close();
            });


            // Select Data through keypress From PopUp
            $("#LCIDWindow").keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    ListOfValueOpeningLCIDGridGridEvent('LCIDGrid');
                    LCIDWindow.close();
                }
                else if (keycode == '27') {
                    LCIDWindow.close();
                }
                event.stopPropagation();
            });



            //To Bring Data from List of Value Grid to Main Page
            function ListOfValueOpeningLCIDGridGridEvent(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                var selectedItem = (grid.dataItem(grid.select()));
                $.each(selectedItem, function (key, value) {
                    if (value != null && value != 0)
                        $('#' + key).val(value);
                });
                $("#LCID").val(selectedItem.LCID);
                $("#LCNo").val(selectedItem.LCNo);

                $("#PLID").val(selectedItem.PLID);
                $("#PLNo").val(selectedItem.PLNo);

                $("#CIID").val(selectedItem.CIID);
                $("#CIRefNo").val(selectedItem.CIRefNo);
                $("#BalesNo").val(selectedItem.BalesNo);
                $("#TotalBales").val(selectedItem.TotalBales);
            }

            //Select Data from Pop up Grid
            function SelectedItemOfListOfValue(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                grid.dataSource.read();
                $('#' + gridName).data("kendoGrid").dataSource.filter([]);
                $('#' + gridName).data().kendoGrid.bind('dataBound', function (e) {
                    this.element.find('tbody tr:first').addClass('k-state-selected');
                });
            }

            //$("#btnReset").click(function () {
            //    $('.FormBody input[type=text]').val('');
            //    $('#MessageText').html('');
            //    location.reload();
            //});

            //************************* END OF LC No. Popup *************************************//

            function Reset() {

                $('.Dropdown').val('');
                $('.FormBody input[type=text]').val('');
                // <input id="checkSelection" name="checkbox" type="checkbox" value="true" /> <label style="font-family:Constantia;font-size:x-small">Lock Selection</label>

                $('.FormBody input[type=text]').val('');
                $('.txtBox').val('');//
                $("#CnfBillID").val("");

                $('.FormBody input[type=hidden]').val('');
                $('.FormBody input[type=number]').val('');
                $('.FormBody input[type=button]').attr('disabled', false);
                $('#MessageText').html('');
                $('.FormBody .datePicker').val(getISODateTime(new Date()));
                $('#btnSubmit').attr('disabled', false);
                $('#btnDelete').attr('disabled', false);
                $("#Remarks").val("");
                $('.FormBody').find('input, textarea, button, select').attr('disabled', false);

            }



            ClearOperationalMessage();

            //ClearOperationMsgTextBoxRedColor();

            //**************************************** Save *************************************//


            var expCnFViewModel =
                {
                    "CnfBillID": "", "CnfBillNo": "", "RefCnfBillNo": "", "CnfBillDate": "", "LCID": "", "LCNo": "", "CIID": "",
                    "PLID": "", "BillOfEntryNo": "", "BillOfEntryDate": "", "AssesmentValue": "", "CnfBillNote": "",
                    "CnfAgentID": "", "DutyAccountCharge": "", "PortCharge": "", "ShippingCharge": "", "BerthOperatorCharge": "",
                    "NOCCharge": "", "ExamineCharge": "", "SpecialDeliveryCharge": "", "AmendmentCharge": "", "ChemicalTestCharge": "",
                    "AgencyCommission": "", "StampCharge": "", "TotalAmount": "", "CnfBillCurrency": "", "ExchangeCurrency": "",
                    "ExchangeRate": "", "ExchangeValue": "", "RecordStatus": "", "Remarks": ""
                };

            function Save() {

                saveStatus = 1;
                CheckRequiredTextBoxMaxLength('CnfBillNo', 100);
                if (saveStatus == 1) {
                    expCnFViewModel.LCID = $("#LCID").val();
                    expCnFViewModel.LCNo = $("#LCNo").val();
                    expCnFViewModel.CnfBillID = $("#CnfBillID").val();
                    expCnFViewModel.CnfBillNo = $("#CnfBillNo").val();
                    expCnFViewModel.RefCnfBillNo = $("#RefCnfBillNo").val();
                    expCnFViewModel.CnfBillDate = $("#CnfBillDate").val();
                    expCnFViewModel.CIID = $("#CIID").val();
                    expCnFViewModel.PLID = $("#PLID").val();

                    expCnFViewModel.BillOfEntryNo = $("#BillOfEntryNo").val();
                    expCnFViewModel.BillOfEntryDate = $("#BillOfEntryDate").val();
                    expCnFViewModel.AssesmentValue = $("#AssesmentValue").val();
                    expCnFViewModel.CnfBillNote = $("#CnfBillNote").val();

                    expCnFViewModel.CnfAgentID = $("#BuyerID").val();
                    expCnFViewModel.DutyAccountCharge = $("#DutyAccountCharge").val();
                    expCnFViewModel.PortCharge = $("#PortCharge").val();
                    expCnFViewModel.ShippingCharge = $("#ShippingCharge").val();
                    expCnFViewModel.BerthOperatorCharge = $("#BerthOperatorCharge").val();
                    expCnFViewModel.NOCCharge = $("#NOCCharge").val();
                    expCnFViewModel.ExamineCharge = $("#ExamineCharge").val();
                    expCnFViewModel.SpecialDeliveryCharge = $("#SpecialDeliveryCharge").val();
                    expCnFViewModel.StampCharge = $("#StampCharge").val();
                    expCnFViewModel.ExchangeCurrency = $("#ExchangeCurrency").find('.select').val();
                    expCnFViewModel.ExchangeRate = $("#ExchangeRate").val();
                    expCnFViewModel.ExchangeValue = $("#ExchangeValue").val();
                    expCnFViewModel.AmendmentCharge = $("#AmendmentCharge").val();
                    expCnFViewModel.ChemicalTestCharge = $("#ChemicalTestCharge").val();
                    expCnFViewModel.AgencyCommission = $("#AgencyCommission").val();
                    expCnFViewModel.TotalAmount = $("#TotalAmount").val();
                    expCnFViewModel.CnfBillCurrency = $("#CnfBillCurrency").find('.select').val();
                    expCnFViewModel.RecordStatus = $("#RecordStatus").val();
                    expCnFViewModel.Remarks = $("#Remarks").val();


                    if (expCnFViewModel.CnfBillID == "") {

                        // INSERT DATA

                        $("#divLoading").show();
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("Save", "EXPCnfBill")',
                            data: JSON.stringify(expCnFViewModel),
                            contentType: 'application/json;',
                            dataType: 'json',
                            success: function (data) {
                                $("#divLoading").hide();
                                if (data.msg.Type == 2) {
                                    Reset();
                                    $("#CnfBillID").val(data.ReturnId);
                                    $("#CnfBillNo").val(data.ReturnCode);
                                    $('#MessageText').html(data.msg.Msg);
                                    $("#MessageText").css({ 'text-align': "center", 'color': "green", 'font-weight': "bold", 'font-size': "17px" });

                                }
                                else {
                                    $("#MessageText").html(data.msg.Msg);
                                    $("#MessageText").css("color", "red");
                                }
                            },

                            error: function (respnse) {
                                //alert("Failed: " + respnse.status + ": " + respnse.statusText);
                            },
                            complete: function (data) {
                                $("#divLoading").hide();
                            }
                        });
                    }
                    else {
                        // UPDATE DATA
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("Update", "EXPCnfBill")',
                            data: JSON.stringify(expCnFViewModel),
                            contentType: 'application/json;',
                            dataType: 'json',
                            success: function (data) {
                                //console.log(data);
                                //alert("Updatre");
                                if (data.msg.Type == 2) {
                                    $('#MessageText').html(data.msg.Msg);
                                    $("#MessageText").css({ 'text-align': "center", 'color': "green", 'font-weight': "bold", 'font-size': "17px" });

                                }
                                else {
                                    $("#MessageText").html(data.msg.Msg);
                                    $("#MessageText").css("color", "red");
                                }
                            },
                            error: function (respnse) {
                                // alert("Failed: " + respnse.status + ": " + respnse.statusText);
                            },
                            failure: function (respnse) {
                            }
                        });
                    }
                }
            }




            //********************************** Start Search Data  *******************************


            $("#btnSearch").click(function () {
                SearchResult("GetCnFBillInfo", "EXPCnfBill", "CnfAgentID,LCID,CnfBillID,CIID,PLID");
            });

            $("#btnSearchGridSearch").click(function () {
                GetSearchResult("SearchLcmCnFBillInfoByLCNo", "EXPCnfBill");
            });

            AutoComplete("GetAutoCompleteData", "EXPCnfBill");


            function ListOfValueSearchGridEvent(gridName) {
                var grid = $('#' + gridName).data("kendoGrid");
                var selectedItem = (grid.dataItem(grid.select()));
                $.each(selectedItem, function (key, value) {
                    if (value != null && value != 0)
                        $('#' + key).val(value);
                });
                $("#CnfBillID").val(selectedItem.CnfBillID);
                $("#LCID").val(selectedItem.LCID);
                $("#LCNo").val(selectedItem.LCNo);

                Reset();

                $("#divLoading").show();

                $.ajax({
                    url: '@Url.Action("GetCnFBillInfoByCnfBillID", "EXPCnfBill")',
                    type: 'GET',
                    data: { CnfBillID: selectedItem.CnfBillID },
                    success: function (response) {
                        $("#divLoading").hide();


                        $("#CnfBillID").val(response.CnfBillID);
                        $("#CnfBillNo").val(response.CnfBillNo);
                        $("#RefCnfBillNo").val(response.RefCnfBillNo);
                        $("#CnfBillDate").val(response.CnfBillDate);

                        $("#Address").val(response.Address);
                        $("#EmailAddress").val(response.EmailAddress);
                        $("#ContactPerson").val(response.ContactPerson);
                        $("#ContactNumber").val(response.ContactNumber);
                        $("#PhoneNo").val(response.PhoneNo);



                        $("#LCID").val(response.LCID);
                        $("#LCNo").val(response.LCNo);
                        $("#CIID").val(response.CIID);
                        $("#CIRefNo").val(response.CIRefNo);

                        $("#BalesNo").val(response.BalesNo);
                        $("#TotalBales").val(response.TotalBales);


                        $("#PLID").val(response.PLID);
                        $("#PLNo").val(response.PLNo);
                        $("#AssesmentValue").val(response.AssesmentValue);
                        $("#BillOfEntryNo").val(response.BillOfEntryNo);
                        $("#BillOfEntryDate").val(response.BillOfEntryDate);
                        $("#CnfBillNote").val(response.CnfBillNote);
                        $("#ExchangeCurrency").val(response.ExchangeCurrency);
                        $("#ExchangeRate").val(response.ExchangeRate);
                        $("#ExchangeValue").val(response.ExchangeValue);
                        $("#CnfAgentID").val(response.CnfAgentID);
                        $("#DutyAccountCharge").val(response.DutyAccountCharge);
                        $("#PortCharge").val(response.PortCharge);
                        $("#ShippingCharge").val(response.ShippingCharge);
                        $("#BerthOperatorCharge").val(response.BerthOperatorCharge);
                        $("#NOCCharge").val(response.NOCCharge);
                        $("#ExamineCharge").val(response.ExamineCharge);
                        $("#SpecialDeliveryCharge").val(response.SpecialDeliveryCharge);
                        $("#StampCharge").val(response.StampCharge);
                        $("#BLVerifyCharge").val(response.BLVerifyCharge);
                        $("#TotalAmount").val(response.TotalAmount);
                        $("#ChemicalTestCharge").val(response.ChemicalTestCharge);
                        $("#AmendmentCharge").val(response.AmendmentCharge);
                        $("#AgencyCommission").val(response.AgencyCommission);
                        $("#CnfBillCurrency").val(response.CnfBillCurrency);
                        $("#RecordStatus").val(response.RecordStatus);
                        $("#BuyerID").val(response.BuyerID);
                        $("#Remarks").val(response.Remarks);
                        $("#BuyerName").val(response.BuyerName);
                        $("#BuyerCode").val(response.BuyerCode);
                        $("#PINo").val(response.PINo);
                        $("#RecordStatus").val(response.RecordStatus);

                        if (selectedItem.RecordStatus == "Not Confirmed") {
                            $("#btnConfirm").removeAttr('disabled');
                            $("#btnCheck").removeAttr('disabled');
                            $("#btnSubmit").removeAttr('disabled');
                        }
                        else if (selectedItem.RecordStatus == "Checked") {
                            $("#btnCheck").attr('disabled', 'disabled');

                        }
                            //else {
                            //    $("#btnCheck").removeAttr('disabled');
                            //}

                        else if (selectedItem.RecordStatus == "Confirmed") {
                            $("#btnConfirm").attr('disabled', 'disabled');
                            $("#btnCheck").attr('disabled', 'disabled');
                            $("#btnSubmit").attr('disabled', 'disabled');
                            $('#btnDelete').attr('disabled', true);

                        }
                        else {
                            $("#btnConfirm").removeAttr('disabled');
                            $("#btnCheck").removeAttr('disabled');
                            $("#btnSubmit").removeAttr('disabled');
                            $('#btnDelete').removeAttr('disabled');
                        }

                    },
                    error: function (xhr, status, error) {
                        alert(xhr.responseText);
                    },
                    complete: function (data) {
                        $("#divLoading").hide();
                    }

                });
            }

            //********************************** END Search Data  *******************************





            //******************************** DELETE CnfBill Information ***********************************



            //###############  CnfBill WINDOW ###############################
            @*$('#btnDelete').click(function () {
                if ($("#CnfBillID").val() != "") {
                    $("#divLoading").show();
                    $.ajax({
                        url: '@Url.Action("DeleteCnFBillList", "EXPCnfBill")',
                        type: 'GET',
                        data: ({ "cnfBillID": $("#CnfBillID").val() }),
                        success: function (data) {

                            $("#divLoading").hide();
                            //console.log(data);
                            //if (data.Type == 2) {
                            //    $('.FormBody input[type=text]').val('');
                            //    $('.Dropdown').val('');
                            //    $('.FormBody input[type=hidden]').val('');
                            //    $('.FormBody input[type=number]').val('');
                            //    $('.FormBody .datePicker').val(getISODateTime(new Date()));
                            //    $('#MessageText').html(data.Msg);
                            //    //$("#GradingGrid").data("kendoGrid").dataSource.data("");
                            //}

                            if (response.Type == 4) {
                                $('.FormBody input[type=text]').val('');
                                $('.Dropdown').val('');
                                $('.FormBody input[type=hidden]').val('');
                                $('.FormBody input[type=number]').val('');
                                $('.FormBody .datePicker').val(getISODateTime(new Date()));
                                $('#MessageText').html(data.Msg);
                                $('#MessageText').html(response.Msg);
                                $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
                            } else {
                                $("#MessageText").html(response.Msg);
                                $("#MessageText").css("color", "red");
                            }
                        },
                        error: function (xhr, status, error) {
                            alert("Error occured !!!");
                        },
                        complete: function (data) {
                            $("#divLoading").hide();
                        }
                    });
                }
            });*@

            var LimInfoDeleteWindow = $('#DeleteLimInfoListConfirmWindow').kendoWindow({
                width: "300px",
                padding: "0px 0px 0px 100px",
                title: "Do You Want To Delete This Record?",
                visible: false,
                modal: true,
                draggable: true
                //position: { top: 300, left: 400 }
            }).data('kendoWindow');

            $("#btnDelete").click(function () {
                if ($("#CnfBillID").val() != "") {
                    gridToDelete = "all";
                    LimInfoDeleteWindow.open();
                    LimInfoDeleteWindow.center();
                } else if ($("#CnfBillID").val() == "" && changeStatus == 1) {
                    $('#MessageText').html("The record you are trying to delete is not in the database.");
                    $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
                } else {

                }
            });


            $('#btnDeleteLimInfoListOK').click(function () {
                if (gridToDelete == "all") {
                    if ($("#BankLoanID").val() != "") {
                        var _cnfBillID = $("#CnfBillID").val();
                        $.ajax({
                            url: '@Url.Action("DeleteCnFBillList", "EXPCnfBill")',
                            type: 'GET',
                            data: ({ "cnfBillID": _cnfBillID }),
                            contentType: 'application/json;',
                            dataType: 'json',
                            success: function (response) {
                                
                                if (response.Type == 4) {
                                    $('#MessageText').html(response.Msg);
                                    $("#MessageText").css({ 'color': 'green', 'font-size': 'larger', 'font-weight': 'bold', 'text-align': 'center' });
                                   
                                } else {
                                    $("#MessageText").html(response.Msg);
                                    $("#MessageText").css("color", "red");
                                   
                                }
                                LimInfoDeleteWindow.close();
                                
                            }
                        });
                    }
                    gridToDelete = "";
                    LimInfoDeleteWindow.close();
                    //Reset();
                }
            });
            $("#btnDeleteLimInfoListCancel").click(function () {
                LimInfoDeleteWindow.close();
            });
            //############################################################### CONFIRM CnF Bill ###################################################

            $("#btnConfirm").click(function () {
                $("#divLoading").show();
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ConfirmRecordStatus", "EXPCnfBill")',
                    data: { cnfBillID: $("#CnfBillID").val() },
                    success: function (data) {
                        console.log(data);
                        $("#divLoading").hide();
                        if (data.msg.Type == 2) {
                            $('#MessageText').html(data.msg.Msg);
                            $("#MessageText").css({ 'text-align': "center", 'color': "green", 'font-weight': "bold", 'font-size': "17px" });
                            $("#btnConfirm").attr('disabled', 'disabled');
                            $("#btnChecked").attr('disabled', 'disabled');
                            $('#btnDelete').attr('disabled', true);
                            $("#btnSubmit").attr('disabled', 'disabled');
                        }
                        else {
                            $("#MessageText").html(data.msg.Msg);
                            $("#MessageText").css("color", "red");
                        }
                    },
                    error: function (respnse) {
                        // alert("Failed: " + respnse.status + ": " + respnse.statusText);
                        $("#divLoading").hide();
                    },
                    complete: function (data) {
                        $("#divLoading").hide();
                    }
                });
            });

            //############################################################### END OF CONFIRMED CnfBill ###################################################


        </script>